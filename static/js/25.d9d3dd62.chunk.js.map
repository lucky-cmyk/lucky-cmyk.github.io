{"version":3,"sources":["pages/Security/Security.js","utils/utc.js","components/DatePicker/index.js","components/ListPage/index.js","utils/columnSearch.js"],"names":["props","useState","total","data","dataSource","setDataSource","fetchData","params","a","axios","get","resp","code","lastLoginMap","lastLogin","length","map","item","uid","time","dataList","log","tmp","reg_time","user","uname","last_login","push","columns","title","dataIndex","key","getColumnSearchProps","render","to","dayjs","unix","utc","utcOffset","format","reason","with_uid","Page","ListPage","fetchApi","pageSize","rangeSearch","showTime","showTotal","range","require","extend","formatIndia","unixtime","layout","DatePicker","generatePicker","dayjsGenerateConfig","RangePicker","Index","forceUpdate","components","current","rowSelection","defaultRangeTime","rangeTime","loading","setLoading","pagination","setPagination","filters","setFilters","sorter","setSorter","setRangeTime","disabled","setDisabled","dates","setDates","index","page","startTime","endTime","console","useEffect","disabledDate","rangeDays","tooLate","diff","defaultValue","onChange","dateStrings","onCalendarChange","value","type","onClick","dashed","scroll","x","bordered","order","columnKey","memo","prev","next","JSON","stringify","handleSearch","selectedKeys","confirm","filterDropdown","setSelectedKeys","clearFilters","style","padding","placeholder","e","target","onPressEnter","width","marginBottom","display","icon","size","filterIcon","filtered","color","undefined"],"mappings":"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","file":"static/js/25.d9d3dd62.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\nimport dayjs from 'utils/utc';\r\n\r\nimport axios from 'utils/axios'\r\nimport Page from \"../../components/Page\";\r\nimport ListPage from 'components/ListPage'\r\nimport { getColumnSearchProps } from 'utils/columnSearch';\r\nimport {Link} from \"react-router-dom\";\r\n\r\nexport default (props) => {\r\n  const [dataSource, setDataSource] = useState({total: 0, data: []});\r\n\r\n  const fetchData = async params => {\r\n    let resp = await axios.get('/security/flagLog', {params});\r\n    if (resp.code !== 0) return ;\r\n\r\n    const data = resp.data;\r\n    const lastLoginMap = {};\r\n    if (data.lastLogin && data.lastLogin.length > 0) {\r\n      data.lastLogin.map(item => {\r\n        lastLoginMap[item.uid] = item.time;\r\n      })\r\n    }\r\n\r\n    const dataList = [];\r\n    if (data.log) {\r\n      data.log.map(item => {\r\n        const tmp = item.log;\r\n        tmp.reg_time = item.user.reg_time;\r\n        tmp.uname = item.user.uname;\r\n        tmp.last_login = lastLoginMap[item.user[\"uid\"]];\r\n        dataList.push(tmp);\r\n      });\r\n    }\r\n\r\n    // console.log(\"ddddd\", resp);\r\n    setDataSource({total: data.total, data: dataList})\r\n  };\r\n\r\n  const columns = [\r\n    { title: '序号', dataIndex: 'key' },\r\n    { title: 'UID', dataIndex: 'uid', key: 'uid', ...getColumnSearchProps('uid'),\r\n      render: user => <Link to={`/user/userInfo?uid=${user}`}>{user}</Link>\r\n    },\r\n    { title: '昵称', key: 'uname', dataIndex: 'uname'},\r\n    { title: '标记时间', key: 'create_time', dataIndex: 'create_time', render: time => dayjs.unix(time).utc().utcOffset(330).format('YYYY-MM-DD HH:mm:ss')},\r\n    { title: '注册时间', key: 'reg_time', dataIndex: 'reg_time', render: time => dayjs.unix(time).utc().utcOffset(330).format('YYYY-MM-DD HH:mm:ss')},\r\n    { title: '最后登录时间', key: 'last_login', dataIndex: 'last_login', render: time => dayjs.unix(time).utc().utcOffset(330).format('YYYY-MM-DD HH:mm:ss')},\r\n    { title: '标记原因', key: 'reason', dataIndex: 'reason',\r\n      render: reason => {\r\n        const flagMap = {\r\n          1: \"连续弃牌\",\r\n          2: \"连续诈胡\",\r\n          3: \"连续吃牌\",\r\n          4: \"连续赢\",\r\n        };\r\n        return flagMap[reason];\r\n      }\r\n    },\r\n    { title: '关联UID', key: 'with_uid', dataIndex: 'with_uid',\r\n      render: with_uid => <Link to={`/user/userInfo?uid=${with_uid}`}>{with_uid}</Link>\r\n    },\r\n  ];\r\n\r\n  return <Page title=\"异常用户名单\">\r\n    <ListPage\r\n      columns={columns}\r\n      fetchApi={fetchData}\r\n      data={dataSource.data}\r\n      total={dataSource.total}\r\n      pageSize={20}\r\n      rangeSearch={{showTime: true}}\r\n      showTotal={(total, range) => `第${range[0]}-${range[1]}条, 共${total}条数据`}\r\n    />\r\n  </Page>;\r\n}\r\n","import dayjs from 'dayjs';\r\nconst utc = require('dayjs/plugin/utc');\r\n\r\ndayjs.extend(utc);\r\n\r\nexport const formatIndia = (unixtime, layout = \"YYYY-MM-DD HH:mm:ss\") => {\r\n  return dayjs.unix(unixtime).utc().utcOffset(330).format(layout);\r\n};\r\n\r\nexport default dayjs;\r\n","import dayjsGenerateConfig from 'rc-picker/lib/generate/dayjs';\r\nimport generatePicker from 'antd/lib/date-picker/generatePicker';\r\nimport 'antd/lib/date-picker/style/index';\r\n\r\nconst DatePicker = generatePicker(dayjsGenerateConfig);\r\n\r\nexport default DatePicker;\r\n","import React, { useEffect, useState, memo } from 'react';\r\nimport { Table, Button, Space, Divider } from 'antd';\r\nimport DatePicker from 'components/DatePicker';\r\n\r\nconst { RangePicker } = DatePicker;\r\n\r\nfunction Index(props) {\r\n  const { fetchApi, columns, forceUpdate, data, rangeSearch, components, current,total, pageSize, showTotal, rowSelection } = props;\r\n  const defaultRangeTime = rangeSearch ?\r\n    (rangeSearch.rangeTime ? [\r\n      rangeSearch.rangeTime[0].format(rangeSearch.layout || \"YYYY-MM-DD HH:mm:ss\"),\r\n      rangeSearch.rangeTime[1].format(rangeSearch.layout || \"YYYY-MM-DD HH:mm:ss\"),\r\n    ] : null) :\r\n    null;\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [pagination, setPagination] = useState({ current: 1, pageSize: pageSize || 20, total: total || 100000, showTotal: showTotal});\r\n  const [filters, setFilters] = useState({});\r\n  const [sorter, setSorter] = useState([]);\r\n  const [rangeTime, setRangeTime] = useState(defaultRangeTime);\r\n  const [disabled, setDisabled] = useState(!rangeTime);\r\n  const [dates, setDates] = useState(rangeSearch ? rangeSearch.rangeTime || [] : null);\r\n\r\n  const dataSource = data.map((user, index) => {\r\n    return {\r\n      ...user,\r\n      key: index + 1,\r\n    }\r\n  });\r\n\r\n  const fetchData = async (pagination, filters, sorter) => {\r\n    setLoading(true);\r\n\r\n    let params = {\r\n      page: pagination.current,\r\n      pageSize: pagination.pageSize,\r\n      filters: filters\r\n    };\r\n\r\n    if (rangeTime) {\r\n      params.startTime = rangeTime[0];\r\n      params.endTime = rangeTime[1];\r\n    }\r\n\r\n    if (sorter.length > 0) {\r\n      params.sorter = sorter[0]\r\n    }\r\n    console.log(\"rangeTime\", rangeTime, params)\r\n\r\n    await fetchApi(params);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    setPagination({...pagination, total: total || 10000})\r\n  }, [total/*, pageSize*/]);\r\n\r\n  useEffect(() => {\r\n\r\n    fetchData(pagination, filters, sorter)\r\n\r\n    if(current){\r\n      current(pagination)\r\n    }\r\n\r\n  }, [/*pagination, */filters, forceUpdate, sorter, pageSize, pagination.current]);\r\n\r\n  const handleTableChange = (pagination, filters, sorter) => {\r\n    console.log('handleTableChange:', pagination, filters, sorter);\r\n    setPagination(pagination);\r\n    setFilters(filters);\r\n    if (sorter.order) {\r\n      setSorter([{key: sorter.columnKey, order: sorter.order === 'ascend' ? 'asc' : \"desc\"}]);\r\n    } else {\r\n      setSorter([])\r\n    }\r\n  };\r\n\r\n  const rangeChange = (dates, dateStrings) => {\r\n    setRangeTime(dateStrings);\r\n    setDisabled(!dates)\r\n  };\r\n\r\n  const disabledDate = current => {\r\n    if (!dates || dates.length === 0 || !rangeSearch || !rangeSearch.rangeDays) {\r\n      return false;\r\n    }\r\n    // if (rangeSearch.rangeTime) {\r\n    //   console.log(\"current\", current)\r\n    // }\r\n\r\n    const tooLate = dates[0] && current.diff(dates[0], 'days') >= rangeSearch.rangeDays;\r\n    const tooEarly = dates[1] && dates[1].diff(current, 'days') >= rangeSearch.rangeDays;\r\n    return tooEarly || tooLate;\r\n  };\r\n\r\n  return (<>\r\n    {/*<Space direction='vertical' size='middle'>*/}\r\n      {rangeSearch && <Space>\r\n        <RangePicker\r\n          disabledDate={disabledDate}\r\n          defaultValue={rangeSearch.rangeTime || null}\r\n          format={rangeSearch.layout || \"YYYY-MM-DD HH:mm:ss\"}\r\n          showTime={rangeSearch.showTime || false}\r\n          onChange={rangeChange}\r\n          onCalendarChange={value => setDates(value)}\r\n        />\r\n        <Button\r\n          type=\"primary\"\r\n          onClick={() => fetchData(pagination, filters, sorter)}\r\n          disabled={disabled}\r\n        >\r\n          Inquire\r\n        </Button>\r\n        <Divider dashed />\r\n      </Space>}\r\n      {/* <Divider dashed /> */}\r\n\r\n      <Table\r\n        // rowKey={key}\r\n        rowSelection={rowSelection}\r\n        components={components}\r\n        scroll={{ x: true }}\r\n        bordered\r\n        loading={loading}\r\n        pagination={pagination}\r\n        columns={columns}\r\n        dataSource={dataSource}\r\n        onChange={handleTableChange}\r\n      />\r\n  {/*</Space>*/}\r\n  </>);\r\n}\r\nexport default memo(Index, (prev, next) => {\r\n  // console.log(\"prev=\", prev, \"next=\", next);\r\n  return JSON.stringify(prev.data) === JSON.stringify(next.data) &&\r\n    JSON.stringify(prev.columns) === JSON.stringify(next.columns) &&\r\n    prev.forceUpdate == next.forceUpdate\r\n});\r\n","import {Button, Input, Space} from \"antd\";\r\nimport {SearchOutlined} from \"@ant-design/icons\";\r\nimport React from \"react\";\r\n\r\nconst handleSearch = (selectedKeys, confirm, dataIndex) => {\r\n  confirm();\r\n  if (dataIndex) {\r\n    console.log('handleSearch-dataIndex:', dataIndex);\r\n    console.log('handleSearch-selectedKeys:', selectedKeys);\r\n  }\r\n};\r\n\r\nexport const getColumnSearchProps = dataIndex => ({\r\n  filterDropdown: ({ setSelectedKeys, selectedKeys, confirm, clearFilters }) => (\r\n    <div style={{ padding: 8 }}>\r\n      <Input\r\n        placeholder={`Search ${dataIndex}`}\r\n        value={selectedKeys[0]}\r\n        onChange={e => setSelectedKeys(e.target.value ? [e.target.value] : [])}\r\n        onPressEnter={() => handleSearch(selectedKeys, confirm, dataIndex)}\r\n        style={{ width: 188, marginBottom: 8, display: 'block' }}\r\n      />\r\n      <Space>\r\n        <Button\r\n          type=\"primary\"\r\n          onClick={() => handleSearch(selectedKeys, confirm, dataIndex)}\r\n          icon={<SearchOutlined />}\r\n          size=\"small\"\r\n          style={{ width: 90 }}\r\n        >\r\n          Search\r\n        </Button>\r\n        <Button onClick={() => clearFilters()} size=\"small\" style={{ width: 90 }}>\r\n          Reset\r\n        </Button>\r\n      </Space>\r\n    </div>\r\n  ),\r\n  filterIcon: filtered => <SearchOutlined style={{ color: filtered ? '#1890ff' : undefined }} />,\r\n});\r\n"],"sourceRoot":""}